        if target_column:
            X_train, X_test, y_train, y_test = preprocess_data(df_engineered, selected_columns, target_column)

            # Save target variables correctly - no header row, just the values
            pd.DataFrame(y_train).to_csv(os.path.join(app.config['TEMP_FOLDER'], 'y_train.csv'), index=False, header=False)
            pd.DataFrame(y_test).to_csv(os.path.join(app.config['TEMP_FOLDER'], 'y_test.csv'), index=False, header=False)

            session['has_target'] = True
            session['y_train_shape'] = len(y_train)
            session['y_test_shape'] = len(y_test)
            session['target_column'] = target_column 